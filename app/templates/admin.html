{% extends "templates/base.html" %}

{% block title %}
{{ _("Wizarr") }}
{% endblock %}

{% block main %}

{% if APP_UPDATE %}
{% include 'templates/update.html' %}
{% endif %}

{% include 'templates/menu.html' %}

<div id="content" class="max-w-screen-xl mx-auto mt-[64px]">
    {% include subpath %}
</div>

<footer>
    <div class="container flex flex-wrap items-center justify-center mx-auto text-secondary py-2 text-xs">
        <a href="{{ APP_GITHUB_URL }}">{{ APP_NAME }}</a>&nbsp;-&nbsp;{{ _('Version') }}&nbsp;<a href="{{ APP_GITHUB_URL }}/releases/tag/{{ APP_VERSION }}">{{ APP_VERSION }}</a>&nbsp;-&nbsp;{{ APP_RELEASED }}
    </div>
</footer>

<script>
    {# document.getElementById('navbar-button').addEventListener('click', function () {
        var navbarDefault = document.getElementById('navbar-default');

        navbarDefault.classList.toggle('max-h-0');
        navbarDefault.classList.toggle('max-h-96');
    });

    document.querySelectorAll('#navbar-default ul li button').forEach(function (element) {
        element.addEventListener('click', function () {
            var navbarDefault = document.getElementById('navbar-default');

            navbarDefault.classList.add('max-h-0');
            navbarDefault.classList.remove('max-h-96');
        });
    }); #}

    async function logout(that) {

        const response = await fetch('/api/auth/logout', {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'X-CSRF-TOKEN': getCookie('csrf_access_token'),
            },
        });

        if (response.status !== 200) {
            toast.errorToast("{{ _('Logout failed') }}");
            return;
        }

        window.location.href = '/login';

        //const xhr = new XMLHttpRequest();

        //xhr.open('GET', '/login');

        //xhr.onreadystatechange = async function () {
        //    document.getElementById('spinner').classList.remove('htmx-indicator');

        //    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
        //        // Replace the current page with the new page
        //        document.open();
        //        document.write(xhr.responseText);
        //        document.close();

        //        // Update the URL in the browser
        //        window.history.pushState({}, '', '/login');

        //        const data = JSON.parse(localStorage.getItem('user'));

        //        if (data != undefined) {
        //            toast.infoToast("{{ _('Goodbye') }}, " + data.username + "!");
        //            localStorage.removeItem('user');
        //            return;
        //        }

        //        toast.infoToast("{{ _('Logged out successfully') }}");
        //        localStorage.removeItem('user');
        //    }

        //    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status !== 200) {
        //        window.location.href = '/login';
        //    }
        //};

        //xhr.send();
    }
</script>

{% endblock %}