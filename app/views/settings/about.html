<div class="space-y-6 md:space-y-8">

    <div class="rounded border border-red-500 bg-red-400 bg-opacity-20 p-4 backdrop-blur">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fa-solid fa-lg fa-circle-info text-gray-800 dark:text-gray-100"></i>
            </div>
            <div class="ml-3 flex-1 md:flex md:justify-between items-center">
                <p class="text-sm leading-5 text-gray-800 dark:text-gray-100">This is BETA software. Features may be broken and/or unstable. Please report any issues on GitHub!</p>
                <p class="mt-3 text-sm leading-5 md:mt-0 md:ml-6">
                    <a href="http://github.com/{{ GITHUB_SHEBANG }}" class="whitespace-nowrap font-medium text-gray-800 dark:text-gray-100 transition duration-150 ease-in-out hover:dark:text-white" target="_blank" rel="noreferrer">GitHub â†’</a>
                </p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:px-2">
        <div>
            <h1 class="text-2xl font-bold dark:text-white">System Information</h1>
            <dl class="divide-y divide-gray-800 p-1 border-t border-gray-800 mt-4">
                <div>
                    <div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="block text-sm font-bold text-gray-600 dark:text-gray-400">Version</dt>
                        <dd class="flex text-sm dark:text-white sm:col-span-2 sm:mt-0">
                            <span class="flex-grow flex flex-row items-center truncate">
                                <code class="truncate">{{ APP_VERSION }}</code>
                                {% if not APP_RELEASED %}
                                    <a href="https://github.com/{{ GITHUB_SHEBANG }}" target="_blank" rel="noopener noreferrer">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-yellow-500 bg-opacity-80 border border-yellow-500 !text-yellow-100 ml-2 !cursor-pointer transition hover:bg-yellow-400">Beta</span>
                                    </a>
                                {% else %}
                                    <a href="https://github.com/{{ GITHUB_SHEBANG }}/releases" target="_blank" rel="noopener noreferrer">
                                        {% if not APP_UPDATE %}
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-green-500 bg-opacity-80 border border-green-500 !text-green-100 ml-2 !cursor-pointer transition hover:bg-green-400">Up to Date</span>
                                        {% else %}
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full whitespace-nowrap cursor-default bg-red-500 bg-opacity-80 border border-red-500 !text-red-100 ml-2 !cursor-pointer transition hover:bg-red-400">Update Available</span>
                                        {% endif %}
                                    </a>
                                {% endif %}
                            </span>
                        </dd>
                    </div>
                </div>
                <div>
                    <div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="block text-sm font-bold text-gray-600 dark:text-gray-400">Data Directory</dt>
                        <dd class="flex text-sm dark:text-white sm:col-span-2 sm:mt-0">
                            <span class="flex-grow undefined">
                                <code>{{ DATA_DIRECTORY }}</code>
                            </span>
                        </dd>
                    </div>
                </div>
                <div>
                    <div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="block text-sm font-bold text-gray-600 dark:text-gray-400">Time Zone</dt>
                        <dd class="flex text-sm dark:text-white sm:col-span-2 sm:mt-0">
                            <span class="flex-grow undefined">
                                <code>{{ TIMEZONE }}</code>
                            </span>
                        </dd>
                    </div>
                </div>
            </dl>
        </div>
        <div>
            <h1 class="text-2xl font-bold dark:text-white">Support</h1>
            <dl class="divide-y divide-gray-800 p-1 border-t border-gray-800 mt-4">
                <div>
                    <div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="block text-sm font-bold text-gray-600 dark:text-gray-400">Documentation</dt>
                        <dd class="flex text-sm dark:text-white sm:col-span-2 sm:mt-0">
                            <span class="flex-grow undefined">
                                <a href="{{ DOCS_URL }}" target="_blank" rel="noreferrer" class="text-primary transition duration-300 hover:underline">{{ DOCS_URL }}</a>
                            </span>
                        </dd>
                    </div>
                </div>
                <div>
                    <div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="block text-sm font-bold text-gray-600 dark:text-gray-400">GitHub Discussions</dt>
                        <dd class="flex text-sm dark:text-white sm:col-span-2 sm:mt-0">
                            <span class="flex-grow undefined">
                                <a href="https://github.com/{{ GITHUB_SHEBANG }}/discussions" target="_blank" rel="noreferrer" class="text-primary transition duration-300 hover:underline">https://github.com/{{ GITHUB_SHEBANG }}/discussions</a>
                            </span>
                        </dd>
                    </div>
                </div>
                <div>
                    <div class="max-w-6xl py-4 sm:grid sm:grid-cols-3 sm:gap-4">
                        <dt class="block text-sm font-bold text-gray-600 dark:text-gray-400">Discord</dt>
                        <dd class="flex text-sm dark:text-white sm:col-span-2 sm:mt-0">
                            <span class="flex-grow undefined">
                                <a href="https://discord.gg/{{ DISCORD_INVITE }}" target="_blank" rel="noreferrer" class="text-primary transition duration-300 hover:underline">https://discord.gg/{{ DISCORD_INVITE }}</a>
                            </span>
                        </dd>
                    </div>
                </div>
            </dl>
        </div>
    </div>

    <div class="grid grid-cols-1 gap-4 md:px-2">

        <div id="change-log" class="flex flex-col justify-center items-center w-full space-y-4">
            <p class="text-gray-400 text-sm">Loading...</p>
        </div>

        <div class="flex flex-col justify-center items-center w-full space-y-4">
            <button id="load-more" class="inline-flex items-center justify-center leading-5 font-medium rounded focus:outline-none transition ease-in-out duration-150 cursor-pointer whitespace-nowrap dark:text-white bg-secondary px-4 py-2 text-sm button-md ">
                {{ _("Load More") }}
            </button>
        </div>

    </div>
</div>

<script>

    function changeLogItem() {
        const div1 = document.createElement('div');
        div1.classList.add('flex', 'w-full', 'flex-col', 'space-y-3', 'rounded', 'bg-gray-800', 'p-4', 'shadow-md', 'ring-1', 'ring-gray-700', 'sm:flex-row', 'sm:space-y-0', 'sm:space-x-3');

        const div2 = document.createElement('div');
        div2.classList.add('flex', 'w-full', 'flex-grow', 'items-center', 'justify-start', 'space-x-4', 'truncate', 'sm:justify-start');

        const div3 = document.createElement('div');
        div3.classList.add('aspect-square', 'h-full', 'bg-gray-100', 'rounded', 'flex', 'items-center', 'justify-center', 'bg-gray-100', 'dark:bg-gray-700', 'group-hover:bg-gray-200', 'dark:group-hover:bg-gray-600', 'transition', 'duration-150', 'ease-in-out');

        const i = document.createElement('i');
        i.classList.add('fa-solid', 'fa-code-merge', 'text-gray-400');

        const div4 = document.createElement('div');
        div4.classList.add('dark:text-white', 'font-bold', 'flex', 'flex-col', 'items-start');

        const h2 = document.createElement('h2');
        h2.classList.add('text-lg', 'truncate');
        h2.textContent = 'v1.0.0';

        const h4 = document.createElement('h4');
        h4.classList.add('text-sm', 'truncate', 'text-gray-400');
        h4.textContent = 'Released 2021-10-01';

        const button = document.createElement('button');
        button.classList.add('inline-flex', 'items-center', 'justify-center', 'leading-5', 'font-medium', 'rounded', 'focus:outline-none', 'transition', 'ease-in-out', 'duration-150', 'cursor-pointer', 'whitespace-nowrap', 'dark:text-white', 'bg-primary', 'px-4', 'py-2', 'text-sm', 'button-md');

        const span1 = document.createElement('span');
        span1.classList.add('flex', 'items-center');

        const span2 = document.createElement('span');
        span2.textContent = 'View Changelog';

        span1.appendChild(span2);
        button.appendChild(span1);

        div3.appendChild(i);
        div2.appendChild(div3);
        div4.appendChild(h2);
        div4.appendChild(h4);
        div2.appendChild(div4);
        div1.appendChild(div2);
        div1.appendChild(button);

        return div1;
    }

    function messageDiv(text) {
        const div1 = document.createElement('div');
        div1.classList.add('flex', 'w-full', 'justify-center', 'text-gray-400', 'dark:text-gray-600');
        div1.textContent = text;
        return div1;
    }

    async function changeLog(per_page = 5, page = 1) {

        const response = await fetch('https://api.github.com/repos/{{ GITHUB_SHEBANG }}/releases?per_page=' + per_page + '&page=' + page, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
        })


        if (!response.ok) {
            document.getElementById('load-more').style.display = 'none';
            document.getElementById('change-log').appendChild(messageDiv('Failed to load changelog.'));
            return;
        }

        const json = await response.json();

        if (json.length === 0) {
            document.getElementById('load-more').style.display = 'none';
            document.getElementById('change-log').appendChild(messageDiv('No more releases to show.'));
            return;
        }

        for (const release of json) {
            const item = changeLogItem();
            item.querySelector('h2').textContent = release.tag_name;
            item.querySelector('h4').textContent = 'Released ' + release.published_at.split('T')[0];
            item.querySelector('button').addEventListener('click', function () {
                window.open(release.html_url, '_blank');
            });
            document.getElementById('change-log').appendChild(item);
        }
    }

    async function loadChangeLog() {
        var per_page = 5;
        var loaded = 0;

        document.getElementById('change-log').innerHTML = '';
        changeLog(per_page, ++loaded);

        document.getElementById('load-more').addEventListener('click', async function () {
            document.getElementById('load-more').disabled = true;
            document.getElementById('load-more').textContent = 'Loading...';
            await changeLog(per_page, ++loaded);
            document.getElementById('load-more').disabled = false;
            document.getElementById('load-more').textContent = '{{ _("Load More") }}';
        });
    }

    document.addEventListener('DOMContentLoaded', loadChangeLog);

    if (document.readyState === 'complete') {
        loadChangeLog();
    }

</script>